openapi: 3.0.3
info:
  title: üé´ API de Gestion de Tickets
  description: |
    
    Cette API REST permet de g√©rer un syst√®me de tickets avec file d'attente. 
    Elle offre une gestion compl√®te du cycle de vie des tickets 
  
    
  version: 1.0.0
  contact:
    name: API Support
    email: rasendraminosarobidy@gmail.com
    url: https://github.com/Sarobidy-R/Java-API-Exam
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:8080
    description: üõ†Ô∏è Serveur de d√©veloppement (local)
  - url: https://java-api-exam-latest.onrender.com/
    description: üåê Serveur de production
tags:
  - name: üè† G√©n√©ral
    description: Endpoints g√©n√©raux et utilitaires
  - name: üé´ Tickets
    description: Gestion des tickets et de leur cycle de vie
  - name: üìã File d'attente
    description: Op√©rations sur la file d'attente (FIFO)
paths:
  /:
    get:
      tags:
        - üè† G√©n√©ral
      summary: üéâ Endpoint d'accueil
      description: |
        Retourne un message de bienvenue pour v√©rifier que l'API est accessible.
        
        **Utilisation :** Point d'entr√©e pour tester la connectivit√© de l'API.
      operationId: getWelcome
      responses:
        '200':
          description: ‚úÖ Message de bienvenue
          content:
            text/plain:
              schema:
                type: string
                example: "Holla depuis le serveur Java API ! üöÄ"
              examples:
                welcome:
                  value: "Holla depuis le serveur Java API ! üöÄ"
                  summary: Message d'accueil standard

  /api/tickets:
    post:
      tags:
        - üé´ Tickets
      summary: ‚ûï Cr√©er un nouveau ticket
      description: |
        Cr√©e un nouveau ticket avec un num√©ro unique auto-g√©n√©r√© et l'ajoute automatiquement 
        √† la file d'attente avec le statut **WAITING**.
        
        **Processus :**
        1. G√©n√©ration automatique du num√©ro de ticket
        2. Assignation du statut WAITING
        3. Ajout √† la file d'attente
        4. Retour des informations du ticket cr√©√©
      operationId: createTicket
      responses:
        '201':
          description: ‚úÖ Ticket cr√©√© avec succ√®s
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
              examples:
                new_ticket:
                  value:
                    ticketNumber: 1
                    status: "WAITING"
                    creationDate: "2025-07-11T10:30:00Z"
                    calledDate: null
                    servedDate: null
                  summary: Nouveau ticket cr√©√©
        '500':
          $ref: '#/components/responses/InternalServerError'
    
    get:
      tags:
        - üé´ Tickets
      summary: üìã Lister les tickets en attente
      description: |
        Retourne la liste compl√®te des tickets ayant le statut **WAITING**, 
        c'est-√†-dire ceux qui sont en attente d'√™tre appel√©s.
        
        **Note :** Les tickets sont retourn√©s dans l'ordre de cr√©ation (FIFO).
      operationId: getWaitingTickets
      responses:
        '200':
          description: ‚úÖ Liste des tickets en attente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
              examples:
                waiting_tickets:
                  value:
                    - ticketNumber: 1
                      status: "WAITING"
                      creationDate: "2025-07-11T10:30:00Z"
                      calledDate: null
                      servedDate: null
                    - ticketNumber: 2
                      status: "WAITING"
                      creationDate: "2025-07-11T10:31:00Z"
                      calledDate: null
                      servedDate: null
                  summary: Tickets en attente
                empty_list:
                  value: []
                  summary: Aucun ticket en attente
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/tickets/call:
    post:
      tags:
        - üé´ Tickets
      summary: üìû Appeler un ticket
      description: |
        Fait passer un ticket du statut **WAITING** au statut **CALLED**.
        
        **Processus :**
        1. Recherche du ticket par num√©ro dans la file d'attente
        2. Changement du statut vers CALLED
        3. D√©placement vers la liste des tickets appel√©s
        4. Enregistrement de la date d'appel
        
        **Pr√©requis :** Le ticket doit avoir le statut WAITING.
      operationId: callTicket
      requestBody:
        required: true
        description: Num√©ro du ticket √† appeler
        content:
          text/plain:
            schema:
              type: integer
              minimum: 1
              example: 1
            examples:
              ticket_1:
                value: 1
                summary: Appeler le ticket num√©ro 1
              ticket_5:
                value: 5
                summary: Appeler le ticket num√©ro 5
      responses:
        '200':
          description: ‚úÖ Ticket appel√© avec succ√®s
          content:
            text/plain:
              schema:
                type: string
                example: "Ticket appel√©"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: ‚ùå Ticket non trouv√© ou d√©j√† appel√©
          content:
            text/plain:
              schema:
                type: string
                example: "Ticket non trouv√© ou d√©j√† appel√©"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/tickets/serve:
    post:
      tags:
        - üé´ Tickets
      summary: ‚úÖ Servir un ticket
      description: |
        Fait passer un ticket du statut **CALLED** au statut **SERVED**.
        
        **Processus :**
        1. Recherche du ticket par num√©ro dans la liste des tickets appel√©s
        2. Changement du statut vers SERVED
        3. D√©placement vers la liste des tickets servis
        4. Enregistrement de la date de service
        
        **Pr√©requis :** Le ticket doit avoir le statut CALLED.
      operationId: serveTicket
      requestBody:
        required: true
        description: Num√©ro du ticket √† servir
        content:
          text/plain:
            schema:
              type: integer
              minimum: 1
              example: 1
            examples:
              ticket_1:
                value: 1
                summary: Servir le ticket num√©ro 1
              ticket_3:
                value: 3
                summary: Servir le ticket num√©ro 3
      responses:
        '200':
          description: ‚úÖ Ticket servi avec succ√®s
          content:
            text/plain:
              schema:
                type: string
                example: "Ticket servi"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: ‚ùå Ticket non trouv√© ou non appel√©
          content:
            text/plain:
              schema:
                type: string
                example: "Ticket non trouv√© ou non appel√©"
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/tickets/called:
    get:
      tags:
        - üé´ Tickets
      summary: üìû Lister les tickets appel√©s
      description: |
        Retourne la liste des tickets ayant le statut **CALLED**, 
        c'est-√†-dire ceux qui ont √©t√© appel√©s mais pas encore servis.
        
        **Utilisation :** Affichage des tickets en cours de traitement.
      operationId: getCalledTickets
      responses:
        '200':
          description: ‚úÖ Liste des tickets appel√©s
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
              examples:
                called_tickets:
                  value:
                    - ticketNumber: 1
                      status: "CALLED"
                      creationDate: "2025-07-11T10:30:00Z"
                      calledDate: "2025-07-11T10:35:00Z"
                      servedDate: null
                  summary: Tickets appel√©s
                empty_list:
                  value: []
                  summary: Aucun ticket appel√©
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/tickets/served:
    get:
      tags:
        - üé´ Tickets
      summary: ‚úÖ Lister les tickets servis
      description: |
        Retourne la liste des tickets ayant le statut **SERVED**, 
        c'est-√†-dire ceux qui ont √©t√© compl√®tement trait√©s.
        
        **Utilisation :** Historique des tickets trait√©s et statistiques.
      operationId: getServedTickets
      responses:
        '200':
          description: ‚úÖ Liste des tickets servis
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
              examples:
                served_tickets:
                  value:
                    - ticketNumber: 1
                      status: "SERVED"
                      creationDate: "2025-07-11T10:30:00Z"
                      calledDate: "2025-07-11T10:35:00Z"
                      servedDate: "2025-07-11T10:40:00Z"
                  summary: Tickets servis
                empty_list:
                  value: []
                  summary: Aucun ticket servi
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/queue/enqueue:
    post:
      tags:
        - üìã File d'attente
      summary: ‚ûï Ajouter un ticket √† la file
      description: |
        Cr√©e un nouveau ticket et l'ajoute automatiquement √† la file d'attente.
        
        **Note :** Cet endpoint fait la m√™me chose que `POST /api/tickets` 
        mais est expos√© dans le contexte de la file d'attente.
        
        **Principe FIFO :** Le ticket sera trait√© dans l'ordre d'arriv√©e.
      operationId: enqueueTicket
      responses:
        '201':
          description: ‚úÖ Ticket ajout√© √† la file avec succ√®s
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
              examples:
                enqueued_ticket:
                  value:
                    ticketNumber: 3
                    status: "WAITING"
                    creationDate: "2025-07-11T10:32:00Z"
                    calledDate: null
                    servedDate: null
                  summary: Ticket ajout√© √† la file
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/queue/dequeue:
    post:
      tags:
        - üìã File d'attente
      summary: ‚¨ÜÔ∏è Retirer le ticket en t√™te de file
      description: |
        Retire et retourne le ticket en **t√™te de file** (le plus ancien).
        
        **Principe FIFO :** Le premier ticket ajout√© est le premier retir√©.
        
        **Attention :** Cette op√©ration retire d√©finitivement le ticket de la file.
        Pour simplement consulter le prochain ticket, utilisez `GET /api/queue/peek`.
      operationId: dequeueTicket
      responses:
        '200':
          description: ‚úÖ Ticket retir√© avec succ√®s
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
              examples:
                dequeued_ticket:
                  value:
                    ticketNumber: 1
                    status: "WAITING"
                    creationDate: "2025-07-11T10:30:00Z"
                    calledDate: null
                    servedDate: null
                  summary: Ticket retir√© de la file
        '400':
          description: ‚ùå File d'attente vide
          content:
            text/plain:
              schema:
                type: string
                example: "La file est vide"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/queue/peek:
    get:
      tags:
        - üìã File d'attente
      summary: üëÄ Voir le prochain ticket
      description: |
        Retourne le ticket en **t√™te de file** sans le retirer.
        
        **Utilisation :** Consulter le prochain ticket √† traiter sans affecter la file.
        
        **Note :** Le ticket reste dans la file apr√®s cette op√©ration.
      operationId: peekQueue
      responses:
        '200':
          description: ‚úÖ Prochain ticket dans la file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
              examples:
                next_ticket:
                  value:
                    ticketNumber: 2
                    status: "WAITING"
                    creationDate: "2025-07-11T10:31:00Z"
                    calledDate: null
                    servedDate: null
                  summary: Prochain ticket √† traiter
        '400':
          description: ‚ùå File d'attente vide
          content:
            text/plain:
              schema:
                type: string
                example: "La file est vide"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/queue/isEmpty:
    get:
      tags:
        - üìã File d'attente
      summary: ‚ùì V√©rifier si la file est vide
      description: |
        V√©rifie si la file d'attente contient des tickets.
        
        **Retour :**
        - `true` : Aucun ticket en attente
        - `false` : Au moins un ticket en attente
      operationId: isQueueEmpty
      responses:
        '200':
          description: ‚úÖ √âtat de la file d'attente
          content:
            text/plain:
              schema:
                type: string
                enum: ["true", "false"]
                example: "false"
              examples:
                empty_queue:
                  value: "true"
                  summary: File vide
                non_empty_queue:
                  value: "false"
                  summary: File non vide
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/queue/size:
    get:
      tags:
        - üìã File d'attente
      summary: üìä Taille de la file d'attente
      description: |
        Retourne le nombre de tickets actuellement en attente dans la file.
        
        **Utilisation :** Monitoring et statistiques de la file d'attente.
      operationId: getQueueSize
      responses:
        '200':
          description: ‚úÖ Nombre de tickets dans la file
          content:
            text/plain:
              schema:
                type: string
                pattern: '^[0-9]+$'
                example: "3"
              examples:
                empty_queue:
                  value: "0"
                  summary: File vide
                small_queue:
                  value: "3"
                  summary: 3 tickets en attente
                large_queue:
                  value: "15"
                  summary: 15 tickets en attente
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    Ticket:
      type: object
      required:
        - ticketNumber
        - status
        - creationDate
      properties:
        ticketNumber:
          type: integer
          minimum: 1
          description: Num√©ro unique du ticket (auto-g√©n√©r√©)
          example: 1
        status:
          type: string
          enum: ["WAITING", "CALLED", "SERVED"]
          description: |
            Statut actuel du ticket :
            - **WAITING** : En attente d'√™tre appel√©
            - **CALLED** : Appel√©, en cours de traitement  
            - **SERVED** : Traitement termin√©
          example: "WAITING"
        creationDate:
          type: string
          format: date-time
          description: Date et heure de cr√©ation du ticket
          example: "2025-07-11T10:30:00Z"
        calledDate:
          type: string
          format: date-time
          nullable: true
          description: Date et heure o√π le ticket a √©t√© appel√© (null si pas encore appel√©)
          example: "2025-07-11T10:35:00Z"
        servedDate:
          type: string
          format: date-time
          nullable: true
          description: Date et heure o√π le ticket a √©t√© servi (null si pas encore servi)
          example: "2025-07-11T10:40:00Z"
      example:
        ticketNumber: 1
        status: "WAITING"
        creationDate: "2025-07-11T10:30:00Z"
        calledDate: null
        servedDate: null


    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Type d'erreur
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: Message d'erreur d√©taill√©
          example: "Le num√©ro de ticket doit √™tre un entier positif"
        timestamp:
          type: string
          format: date-time
          description: Horodatage de l'erreur
          example: "2025-07-11T10:30:00Z"
        path:
          type: string
          description: Chemin de l'endpoint qui a g√©n√©r√© l'erreur
          example: "/api/tickets/call"

  responses:
    BadRequest:
      description: ‚ùå Requ√™te invalide
      content:
        text/plain:
          schema:
            type: string
            example: "Num√©ro de ticket invalide"
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            invalid_ticket_number:
              value:
                error: "VALIDATION_ERROR"
                message: "Le num√©ro de ticket doit √™tre un entier positif"
                timestamp: "2025-07-11T10:30:00Z"
                path: "/api/tickets/call"
              summary: Num√©ro de ticket invalide

    NotFound:
      description: ‚ùå Ressource non trouv√©e
      content:
        text/plain:
          schema:
            type: string
            example: "Ticket non trouv√©"
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            ticket_not_found:
              value:
                error: "NOT_FOUND"
                message: "Aucun ticket trouv√© avec ce num√©ro"
                timestamp: "2025-07-11T10:30:00Z"
                path: "/api/tickets/call"
              summary: Ticket non trouv√©

    InternalServerError:
      description: ‚ùå Erreur interne du serveur
      content:
        text/plain:
          schema:
            type: string
            example: "Erreur interne du serveur"
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            server_error:
              value:
                error: "INTERNAL_ERROR"
                message: "Une erreur inattendue s'est produite"
                timestamp: "2025-07-11T10:30:00Z"
                path: "/api/tickets"
              summary: Erreur serveur